<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Happy Valentine‚Äôs Day, Ba≈üak ‚ù§Ô∏è</title>
  <style>
    :root {
      --bg: #fff7f8;
      --card: #ffffff;
      --text: #2d1c23;
      --muted: #7a5a66;
      --rose: #e85d84;
      --rose-deep: #cf3e67;
      --rose-soft: #ffe4ec;
      --open: #f2b4c6;
      --border: #f3d9e1;
      --shadow: 0 14px 32px rgba(51, 22, 33, 0.12);
      --focus: #cf3e67;
    }

    * {
      box-sizing: border-box;
    }

    html,
    body {
      margin: 0;
      min-height: 100%;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color: var(--text);
      background: radial-gradient(circle at top, #fffdfd 0%, var(--bg) 42%, #ffeef3 100%);
    }

    body {
      line-height: 1.5;
      padding: 1rem;
    }

    .page {
      max-width: 920px;
      margin: 0 auto;
      padding: 1.25rem 0 2rem;
    }

    .card {
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 24px;
      box-shadow: var(--shadow);
    }

    .landing-card {
      max-width: 700px;
      margin: 0 auto;
      padding: 2.2rem 1.25rem 1.7rem;
      text-align: center;
      transition: opacity 380ms ease, transform 380ms ease;
    }

    .landing-card.exiting {
      opacity: 0;
      transform: translateY(-10px) scale(0.985);
      pointer-events: none;
    }

    h1 {
      margin: 0 0 0.6rem;
      font-size: clamp(1.9rem, 4.4vw, 2.75rem);
      line-height: 1.22;
      letter-spacing: -0.02em;
    }

    .subtitle {
      max-width: 52ch;
      margin: 0 auto 1.25rem;
      color: var(--muted);
      font-size: clamp(1.08rem, 2.5vw, 1.26rem);
    }

    .question {
      font-size: clamp(1.35rem, 3.2vw, 1.72rem);
      font-weight: 700;
      margin: 0.35rem 0 0.8rem;
    }

    .warm-line {
      margin: 0.1rem auto 0.85rem;
      color: #6a2d41;
      font-weight: 600;
      font-size: clamp(1rem, 2.3vw, 1.16rem);
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 300ms ease, transform 300ms ease;
    }

    .warm-line.show {
      opacity: 1;
      transform: translateY(0);
    }

    .choice-area {
      position: relative;
      width: min(620px, 100%);
      margin: 0 auto;
      min-height: 220px;
    }

    .choice-area.hidden {
      opacity: 0;
      transform: translateY(-4px);
      pointer-events: none;
      transition: opacity 220ms ease, transform 220ms ease;
    }

    button {
      border: 0;
      border-radius: 999px;
      cursor: pointer;
      font-weight: 700;
      font-size: 1rem;
      letter-spacing: 0.01em;
      transition: transform 180ms ease, box-shadow 180ms ease, background-color 180ms ease, opacity 180ms ease;
    }

    button:focus-visible {
      outline: 3px solid var(--focus);
      outline-offset: 2px;
    }

    .btn-primary {
      background: linear-gradient(145deg, var(--rose) 0%, var(--rose-deep) 100%);
      color: #fff;
      box-shadow: 0 10px 20px rgba(207, 62, 103, 0.28);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 14px 24px rgba(207, 62, 103, 0.3);
    }

    .btn-secondary {
      background: #fff2f6;
      color: #7e3950;
      border: 1px solid #f1c8d5;
    }

    #yesBtn,
    #noBtn {
      position: absolute;
      top: 24px;
      min-width: 132px;
      min-height: 48px;
      padding: 0.74rem 1.1rem;
      will-change: left, top, transform;
    }

    #yesBtn {
      left: calc(50% - 142px);
      z-index: 2;
    }

    #noBtn {
      left: calc(50% + 10px);
      z-index: 3;
    }

    .tiny-caption {
      min-height: 1.2rem;
      margin: 0.4rem 0 0;
      color: #80465a;
      font-size: 0.92rem;
    }

    .hint {
      min-height: 1.25rem;
      margin: 0.15rem 0 0;
      color: #8d4f63;
      font-size: 0.88rem;
    }

    .press-wrap {
      margin-top: 0.45rem;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 250ms ease, transform 250ms ease;
    }

    .press-wrap.show {
      opacity: 1;
      transform: translateY(0);
    }

    #pressBtn {
      min-width: min(420px, 100%);
      max-width: 100%;
      min-height: 58px;
      padding: 0.86rem 1.4rem;
      font-size: clamp(1rem, 2.6vw, 1.2rem);
    }

    #reasonsSection {
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      transform: translateY(20px);
      transition: max-height 500ms ease, opacity 430ms ease, transform 430ms ease;
      pointer-events: none;
    }

    #reasonsSection.visible {
      max-height: 4200px;
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
      margin-top: 1rem;
    }

    .reasons-card {
      padding: 1.5rem 1rem 1.2rem;
    }

    .reasons-header {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 0.9rem;
    }

    .reasons-header h2 {
      margin: 0;
      font-size: clamp(1.25rem, 2.6vw, 1.55rem);
    }

    .progress {
      margin: 0;
      font-weight: 600;
      color: #6a4351;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      margin-bottom: 1rem;
    }

    .control-btn {
      background: #fff;
      color: #754153;
      border: 1px solid #ebcdd8;
      min-height: 42px;
      padding: 0.66rem 1rem;
      border-radius: 14px;
      font-weight: 600;
    }

    .control-btn:hover {
      background: #fff8fb;
    }

    .hearts-grid {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 0.75rem;
    }

    .reason-card {
      background: #fffafd;
      border: 1px solid #f4dbe4;
      border-radius: 16px;
      padding: 0.7rem 0.55rem 0.65rem;
      text-align: center;
      min-height: 158px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      transition: border-color 200ms ease, background-color 200ms ease, transform 200ms ease;
    }

    .reason-card.opened {
      background: #fff4f8;
      border-color: #f0bccd;
    }

    .heart-btn {
      position: relative;
      width: 92px;
      height: 86px;
      background: transparent;
      border-radius: 16px;
      margin: 0.1rem auto 0.34rem;
      padding: 0;
      isolation: isolate;
    }

    .heart-shape {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 42px;
      height: 42px;
      background: var(--rose);
      transform: translate(-50%, -40%) rotate(-45deg);
      border-radius: 10px;
      transition: background-color 220ms ease, transform 220ms ease, filter 220ms ease;
      filter: drop-shadow(0 7px 12px rgba(195, 54, 95, 0.28));
    }

    .heart-shape::before,
    .heart-shape::after {
      content: "";
      position: absolute;
      width: 42px;
      height: 42px;
      background: inherit;
      border-radius: 50%;
    }

    .heart-shape::before {
      top: -21px;
      left: 0;
    }

    .heart-shape::after {
      left: 21px;
      top: 0;
    }

    .heart-index {
      position: absolute;
      z-index: 2;
      left: 50%;
      top: 46%;
      transform: translate(-50%, -50%);
      color: #fff;
      font-size: 0.97rem;
      font-weight: 700;
    }

    .reason-card.opened .heart-shape {
      background: var(--open);
      transform: translate(-50%, -40%) rotate(-45deg) scale(0.95);
      filter: none;
    }

    .reason-text {
      margin: 0.2rem 0 0;
      font-size: 0.92rem;
      color: #583b47;
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      transform: translateY(4px);
      transition: max-height 300ms ease, opacity 260ms ease, transform 260ms ease;
    }

    .reason-card.opened .reason-text {
      max-height: 150px;
      opacity: 1;
      transform: translateY(0);
    }

    .finale {
      margin-top: 1rem;
      background: linear-gradient(145deg, #fff4f7 0%, #ffe8f0 100%);
      border: 1px solid #efc5d3;
      border-radius: 18px;
      padding: 1rem;
      text-align: center;
      opacity: 0;
      transform: translateY(8px);
      transition: opacity 340ms ease, transform 340ms ease;
    }

    .finale.show {
      opacity: 1;
      transform: translateY(0);
    }

    .finale p {
      margin: 0.22rem 0;
    }

    .finale p:first-child {
      font-weight: 700;
      font-size: 1.1rem;
    }

    .one-more-btn {
      margin-top: 0.85rem;
      border-radius: 12px;
      min-height: 42px;
      padding: 0.66rem 1rem;
      border: 1px solid #ebcdd8;
      background: #fff8fb;
      color: #754153;
      font-weight: 700;
    }

    .one-more-btn:hover {
      background: #fff2f7;
    }

    #afterHeartsSection {
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      transform: translateY(20px);
      transition: max-height 520ms ease, opacity 420ms ease, transform 420ms ease;
      pointer-events: none;
    }

    #afterHeartsSection.visible {
      max-height: 7000px;
      opacity: 1;
      transform: translateY(0);
      pointer-events: auto;
      margin-top: 1rem;
    }

    .after-wrap {
      padding: 1.2rem 1rem;
    }

    .after-heading {
      margin: 0 0 0.5rem;
      font-size: clamp(1.2rem, 2.5vw, 1.45rem);
    }

    .after-subtitle {
      margin: 0 0 0.95rem;
      color: #6d4b57;
      font-size: 0.97rem;
    }

    .module-stack {
      display: grid;
      gap: 0.85rem;
    }

    .module-card {
      background: #fffafd;
      border: 1px solid #f3dbe4;
      border-radius: 18px;
      padding: 0.95rem 0.85rem;
    }

    .module-header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 0.55rem;
      margin-bottom: 0.72rem;
    }

    .module-title {
      margin: 0;
      font-size: 1.05rem;
      color: #522f3d;
    }

    .module-progress {
      margin: 0;
      color: #6f4957;
      font-size: 0.9rem;
      font-weight: 600;
    }

    .tiny-link-btn {
      background: transparent;
      border: 0;
      color: #875063;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.88rem;
      min-height: 30px;
      padding: 0.2rem 0.35rem;
    }

    .tiny-link-btn:hover {
      background: #fff3f7;
    }

    .envelope-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 0.65rem;
    }

    .envelope-card {
      background: #fff;
      border: 1px solid #efd4dd;
      border-radius: 14px;
      padding: 0.58rem 0.58rem 0.66rem;
      transition: border-color 220ms ease, background-color 220ms ease;
    }

    .envelope-card.opened {
      border-color: #eab6c8;
      background: #fff5f9;
    }

    .envelope-btn {
      display: block;
      width: 100%;
      border-radius: 11px;
      padding: 0.6rem 0.55rem;
      background: #fff4f8;
      border: 1px solid #efcddd;
      color: #633a4a;
      text-align: left;
      font-weight: 700;
      min-height: 78px;
      transition: transform 220ms ease, background-color 220ms ease;
    }

    .envelope-btn::before {
      content: "‚úâ";
      margin-right: 0.35rem;
      color: #cf3e67;
    }

    .envelope-card.opened .envelope-btn {
      background: #ffeaf1;
      transform: translateY(-1px);
    }

    .envelope-message {
      margin: 0.45rem 0 0;
      font-size: 0.92rem;
      color: #5b3c47;
      max-height: 0;
      opacity: 0;
      overflow: hidden;
      transform: translateY(4px);
      transition: max-height 280ms ease, opacity 260ms ease, transform 260ms ease;
    }

    .envelope-card.opened .envelope-message {
      max-height: 200px;
      opacity: 1;
      transform: translateY(0);
    }

    .quiz-step {
      margin: 0 0 0.25rem;
      color: #7a5a66;
      font-weight: 600;
      font-size: 0.9rem;
    }

    .quiz-question {
      margin: 0 0 0.58rem;
      font-size: 1rem;
      font-weight: 700;
      color: #532f3f;
    }

    .quiz-options {
      display: grid;
      gap: 0.45rem;
    }

    .quiz-option {
      background: #fff;
      color: #5e3b49;
      border: 1px solid #efcfdb;
      border-radius: 12px;
      min-height: 42px;
      padding: 0.62rem 0.75rem;
      text-align: left;
      font-weight: 600;
    }

    .quiz-option:hover {
      background: #fff6fa;
    }

    .quiz-feedback {
      min-height: 1.35rem;
      margin: 0.62rem 0 0;
      color: #7a4f5f;
      font-size: 0.93rem;
      font-weight: 600;
    }

    .quiz-result {
      margin-top: 0.7rem;
      background: #fff4f8;
      border: 1px solid #efbfd0;
      border-radius: 12px;
      padding: 0.68rem 0.72rem;
      color: #5f3a49;
    }

    .quiz-result p {
      margin: 0.16rem 0;
    }

    .secret-wrap {
      display: grid;
      gap: 0.52rem;
      max-width: 520px;
    }

    .secret-label {
      font-weight: 700;
      color: #583746;
      font-size: 0.96rem;
    }

    .secret-row {
      display: flex;
      gap: 0.52rem;
      flex-wrap: wrap;
    }

    .secret-input {
      flex: 1 1 220px;
      min-height: 42px;
      border-radius: 12px;
      border: 1px solid #ebc6d4;
      padding: 0.52rem 0.75rem;
      background: #fff;
      color: #422832;
      font-size: 0.97rem;
    }

    .secret-input:focus-visible {
      outline: 3px solid var(--focus);
      outline-offset: 2px;
    }

    .secret-btn {
      min-height: 42px;
      border-radius: 12px;
      padding: 0.6rem 0.95rem;
      background: #fff2f7;
      border: 1px solid #edc8d7;
      color: #6a3d4d;
      font-weight: 700;
    }

    .secret-btn:hover {
      background: #ffeaf2;
    }

    .secret-hint {
      margin: 0;
      color: #7d5a67;
      font-size: 0.9rem;
    }

    .secret-feedback {
      min-height: 1.3rem;
      margin: 0;
      color: #804f60;
      font-weight: 600;
      font-size: 0.92rem;
    }

    .secret-message {
      margin-top: 0.2rem;
      background: linear-gradient(145deg, #fff1f6 0%, #ffe7ef 100%);
      border: 1px solid #efc0d1;
      border-radius: 12px;
      padding: 0.66rem 0.72rem;
      color: #5b3443;
      opacity: 0;
      transform: translateY(6px);
      transition: opacity 260ms ease, transform 260ms ease;
    }

    .secret-message.show {
      opacity: 1;
      transform: translateY(0);
    }

    .back-top {
      position: fixed;
      right: 0.95rem;
      bottom: 0.95rem;
      z-index: 1000;
      border-radius: 12px;
      border: 1px solid #eabed0;
      background: rgba(255, 248, 252, 0.96);
      color: #6b3d4d;
      font-weight: 700;
      min-height: 40px;
      padding: 0.54rem 0.72rem;
      box-shadow: 0 10px 24px rgba(83, 35, 51, 0.16);
      opacity: 0;
      pointer-events: none;
      transform: translateY(8px);
      transition: opacity 220ms ease, transform 220ms ease, background-color 200ms ease;
    }

    .back-top:hover {
      background: rgba(255, 241, 247, 0.98);
    }

    .back-top.show {
      opacity: 1;
      pointer-events: auto;
      transform: translateY(0);
    }

    #particleLayer {
      position: fixed;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 9999;
    }

    .particle-heart {
      position: absolute;
      left: 0;
      top: 0;
      color: #db4d79;
      font-size: var(--size, 16px);
      opacity: 0;
      transform: translate(-50%, -50%);
      animation: floatHeart var(--dur, 850ms) ease-out forwards;
      text-shadow: 0 2px 10px rgba(201, 74, 113, 0.22);
    }

    @keyframes floatHeart {
      0% {
        opacity: 0.95;
        transform: translate(-50%, -50%) scale(0.85);
      }
      100% {
        opacity: 0;
        transform: translate(calc(-50% + var(--dx, 0px)), calc(-50% + var(--dy, -60px))) scale(1.12);
      }
    }

    @media (max-width: 860px) {
      .hearts-grid {
        grid-template-columns: repeat(3, minmax(0, 1fr));
      }

      .envelope-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }
    }

    @media (max-width: 650px) {
      body {
        padding: 0.72rem;
      }

      .landing-card,
      .reasons-card {
        border-radius: 20px;
      }

      .choice-area {
        min-height: 190px;
      }

      #yesBtn,
      #noBtn {
        min-width: 120px;
        min-height: 46px;
        font-size: 0.96rem;
      }

      #yesBtn {
        left: calc(50% - 126px);
      }

      #noBtn {
        left: calc(50% + 6px);
      }

      .hearts-grid {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .envelope-grid {
        grid-template-columns: repeat(1, minmax(0, 1fr));
      }

      .back-top {
        right: 0.72rem;
        bottom: 0.72rem;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      html {
        scroll-behavior: auto;
      }

      *,
      *::before,
      *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }
  </style>
</head>
<body>
  <main class="page">
    <section id="landingSection" aria-label="Valentine question">
      <div class="card landing-card" id="landingCard">
        <h1>Happy Valentine‚Äôs Day, Ba≈üak ‚ù§Ô∏è</h1>
        <p class="subtitle">I built you a tiny page‚Äîbecause you deserve something made with love.</p>
        <p class="question" id="questionLine">Will you be my Valentine?</p>
        <p class="warm-line" id="warmLine" aria-live="polite">Too late. I already love you more.</p>

        <div class="choice-area" id="choiceArea">
          <button id="yesBtn" class="btn-primary" type="button" aria-label="Yes, be my Valentine">Yes üíò</button>
          <button id="noBtn" class="btn-secondary" type="button" aria-label="No, try to escape">No üôà</button>
        </div>

        <p class="hint" id="dodgeHint" aria-live="polite"></p>
        <p class="tiny-caption" id="oneAnswerCaption" hidden>There is only one correct answer üòå</p>

        <div class="press-wrap" id="pressWrap" hidden>
          <button id="pressBtn" class="btn-primary" type="button" aria-label="Press if you love Metin">Press if you love Metin</button>
        </div>
      </div>
    </section>

    <section id="reasonsSection" aria-label="Reasons I love you">
      <div class="card reasons-card">
        <div class="reasons-header">
          <h2>Reasons I Love You</h2>
          <p class="progress" id="progressText" aria-live="polite">Opened 0 / 12 hearts</p>
        </div>
        <div class="controls">
          <button id="shuffleBtn" class="control-btn" type="button" aria-label="Shuffle hearts">Shuffle hearts</button>
          <button id="resetBtn" class="control-btn" type="button" aria-label="Back to start and reset">Back to start</button>
        </div>
        <div id="heartsGrid" class="hearts-grid" role="list" aria-label="12 reasons hearts"></div>

        <div class="finale" id="finaleCard" hidden>
          <p>You found them all.</p>
          <p>No matter the distance, I choose you‚Äîevery day.</p>
          <p>Forever your Metin.</p>
          <button id="oneMoreBtn" class="one-more-btn" type="button" aria-label="Reveal one more thing" hidden>One more thing‚Ä¶ üíå</button>
        </div>
      </div>
    </section>

    <section id="afterHeartsSection" aria-label="After the hearts experience">
      <div class="card after-wrap">
        <h3 class="after-heading">After the Hearts</h3>
        <p class="after-subtitle">A few more little things, made for you.</p>

        <div class="module-stack">
          <article class="module-card" aria-label="Open when envelopes">
            <div class="module-header">
              <h4 class="module-title">Open When‚Ä¶ Envelope Box</h4>
              <p class="module-progress" id="envelopeProgress" aria-live="polite">Opened 0 / 6</p>
            </div>
            <button id="closeEnvelopesBtn" class="tiny-link-btn" type="button" aria-label="Close all envelopes">Close all</button>
            <div id="envelopeGrid" class="envelope-grid" role="list" aria-label="Open when envelopes"></div>
          </article>

          <article class="module-card" aria-label="How well do you know us quiz">
            <div class="module-header">
              <h4 class="module-title">How Well Do You Know Us?</h4>
            </div>
            <p class="quiz-step" id="quizStepText" aria-live="polite"></p>
            <p class="quiz-question" id="quizQuestionText"></p>
            <div class="quiz-options" id="quizOptions"></div>
            <p class="quiz-feedback" id="quizFeedback" aria-live="polite"></p>
            <div class="quiz-result" id="quizResult" hidden>
              <p id="quizScoreText"></p>
              <p>Perfect score or not‚Äîmy favorite answer is always you.</p>
            </div>
          </article>

          <article class="module-card" aria-label="Secret code unlock">
            <div class="module-header">
              <h4 class="module-title">Secret Code Unlock</h4>
            </div>
            <div class="secret-wrap">
              <label class="secret-label" for="secretCodeInput">Enter the secret code</label>
              <p class="secret-hint">Hint: the city we‚Äôre building our next chapter in.</p>
              <div class="secret-row">
                <input id="secretCodeInput" class="secret-input" type="text" autocomplete="off" aria-label="Secret code input">
                <button id="secretUnlockBtn" class="secret-btn" type="button" aria-label="Unlock secret message">Unlock</button>
              </div>
              <p id="secretFeedback" class="secret-feedback" aria-live="polite"></p>
              <div id="secretMessageCard" class="secret-message" hidden>
                From anywhere in the world, my favorite place is wherever you are.
              </div>
            </div>
          </article>
        </div>
      </div>
    </section>
  </main>

  <div id="particleLayer" aria-hidden="true"></div>
  <button id="backToTopBtn" class="back-top" type="button" aria-label="Back to top">Back to top ‚Üë</button>

  <script>
    const reasons = [
      "Because your music makes the world softer.",
      "Because you make even ordinary days feel special.",
      "Because your kindness is real‚Äînot performative.",
      "Because you're brave when things are hard.",
      "Because you're the calm I look for.",
      "Because you laugh with your whole face.",
      "Because you inspire me to be better.",
      "Because you feel like home.",
      "Because you care deeply‚Äîand it shows.",
      "Because you're my favorite person to talk to.",
      "Because life with you has a beautiful rhythm.",
      "Because I love you. Simple as that."
    ];

    const envelopes = [
      {
        title: "Open when you miss me",
        message: "Close your eyes for 10 seconds. I‚Äôm there‚Äîin the calm between your breaths."
      },
      {
        title: "Open when you feel tired",
        message: "You don‚Äôt have to be strong all the time. Rest. I‚Äôve got you."
      },
      {
        title: "Open when you need courage",
        message: "You‚Äôve done hard things before. You‚Äôll do this one too‚Äîand I‚Äôm cheering for you."
      },
      {
        title: "Open when you want to smile",
        message: "Reminder: your laugh is my favorite soundtrack (right after your cello)."
      },
      {
        title: "Open on our next date",
        message: "I‚Äôm choosing the playlist. You‚Äôre choosing dessert. Deal?"
      },
      {
        title: "Open on a bad day",
        message: "Bad days don‚Äôt get the final word. We do."
      }
    ];

    const quizQuestions = [
      {
        question: "What‚Äôs our superpower?",
        options: [
          "Turning small moments into memories",
          "Never getting sleepy",
          "Always being on time"
        ],
        correct: 0
      },
      {
        question: "What‚Äôs the best duet?",
        options: [
          "Coffee + silence",
          "Your cello + my heart",
          "Spreadsheets + chaos"
        ],
        correct: 1
      },
      {
        question: "Pick our vibe:",
        options: [
          "Cozy & calm",
          "Loud & chaotic",
          "Serious 24/7"
        ],
        correct: 0
      },
      {
        question: "Pick our food:",
        options: [
          "Eggplant and carrot",
          "Egg and bacon",
          "Meat and french fries (potato)"
        ],
        correct: 2
      },
      {
        question: "If love had a soundtrack, it would be:",
        options: [
          "Something you play",
          "White noise",
          "Construction sounds"
        ],
        correct: 0
      }
    ];

    const quizLetters = ["A", "B", "C"];
    const secretCode = "DUBLIN";

    let openedHearts = new Array(12).fill(false);
    let openedCount = 0;
    let noDodgeCount = 0;
    let envelopesOpened = new Array(6).fill(false);
    let quizStep = 0;
    let quizScore = 0;
    let secretUnlocked = false;
    let hasAccepted = false;
    let reasonsVisible = false;
    let afterHeartsVisible = false;
    let yesScale = 1;
    let noPosition = { left: 0, top: 0 };
    let order = Array.from({ length: reasons.length }, (_, i) => i);
    let lastDodgeAt = 0;
    let hintTimer = null;
    let quizLocked = false;
    let quizAdvanceTimer = null;

    const reduceMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
    const isTouchDevice = window.matchMedia("(pointer: coarse)").matches;

    const landingSection = document.getElementById("landingSection");
    const landingCard = document.getElementById("landingCard");
    const reasonsSection = document.getElementById("reasonsSection");
    const questionLine = document.getElementById("questionLine");
    const warmLine = document.getElementById("warmLine");
    const choiceArea = document.getElementById("choiceArea");
    const yesBtn = document.getElementById("yesBtn");
    const noBtn = document.getElementById("noBtn");
    const dodgeHint = document.getElementById("dodgeHint");
    const oneAnswerCaption = document.getElementById("oneAnswerCaption");
    const pressWrap = document.getElementById("pressWrap");
    const pressBtn = document.getElementById("pressBtn");
    const heartsGrid = document.getElementById("heartsGrid");
    const progressText = document.getElementById("progressText");
    const shuffleBtn = document.getElementById("shuffleBtn");
    const resetBtn = document.getElementById("resetBtn");
    const finaleCard = document.getElementById("finaleCard");
    const oneMoreBtn = document.getElementById("oneMoreBtn");
    const afterHeartsSection = document.getElementById("afterHeartsSection");
    const envelopeGrid = document.getElementById("envelopeGrid");
    const envelopeProgress = document.getElementById("envelopeProgress");
    const closeEnvelopesBtn = document.getElementById("closeEnvelopesBtn");
    const quizStepText = document.getElementById("quizStepText");
    const quizQuestionText = document.getElementById("quizQuestionText");
    const quizOptions = document.getElementById("quizOptions");
    const quizFeedback = document.getElementById("quizFeedback");
    const quizResult = document.getElementById("quizResult");
    const quizScoreText = document.getElementById("quizScoreText");
    const secretCodeInput = document.getElementById("secretCodeInput");
    const secretUnlockBtn = document.getElementById("secretUnlockBtn");
    const secretFeedback = document.getElementById("secretFeedback");
    const secretMessageCard = document.getElementById("secretMessageCard");
    const backToTopBtn = document.getElementById("backToTopBtn");
    const particleLayer = document.getElementById("particleLayer");

    function clamp(value, min, max) {
      return Math.min(max, Math.max(min, value));
    }

    function rectsOverlap(a, b, pad) {
      return !(
        a.x + a.w + pad <= b.x ||
        b.x + b.w + pad <= a.x ||
        a.y + a.h + pad <= b.y ||
        b.y + b.h + pad <= a.y
      );
    }

    function setNoPosition(left, top) {
      noPosition.left = left;
      noPosition.top = top;
      noBtn.style.left = left + "px";
      noBtn.style.top = top + "px";
    }

    function setInitialButtonLayout() {
      const areaRect = choiceArea.getBoundingClientRect();
      const yesRect = yesBtn.getBoundingClientRect();
      const noRect = noBtn.getBoundingClientRect();

      const centerX = areaRect.width / 2;
      const top = clamp(20, 10, Math.max(10, areaRect.height - noRect.height - 10));
      const yesLeft = clamp(centerX - yesRect.width - 8, 8, areaRect.width - yesRect.width - 8);
      const noLeft = clamp(centerX + 8, 8, areaRect.width - noRect.width - 8);

      yesBtn.style.left = yesLeft + "px";
      yesBtn.style.top = top + "px";
      setNoPosition(noLeft, top);
    }

    function bumpYesButton() {
      yesScale = Math.min(1 + noDodgeCount * 0.18, 2.85);
      yesBtn.style.transform = "scale(" + yesScale.toFixed(2) + ")";
    }

    function showHint(text) {
      dodgeHint.textContent = text;
      if (hintTimer) {
        clearTimeout(hintTimer);
      }
      hintTimer = setTimeout(() => {
        dodgeHint.textContent = "";
      }, 1100);
    }

    function dodgeNoButton(fromTap) {
      if (hasAccepted) {
        return;
      }

      const now = Date.now();
      if (now - lastDodgeAt < 120) {
        return;
      }
      lastDodgeAt = now;

      const areaRect = choiceArea.getBoundingClientRect();
      const noRectAbs = noBtn.getBoundingClientRect();
      const yesRectAbs = yesBtn.getBoundingClientRect();
      const margin = 10;
      const maxLeft = Math.max(margin, areaRect.width - noRectAbs.width - margin);
      const maxTop = Math.max(margin, areaRect.height - noRectAbs.height - margin);

      const yesRect = {
        x: yesRectAbs.left - areaRect.left,
        y: yesRectAbs.top - areaRect.top,
        w: yesRectAbs.width,
        h: yesRectAbs.height
      };

      let found = null;
      for (let i = 0; i < 90; i += 1) {
        const left = margin + Math.random() * (maxLeft - margin);
        const top = margin + Math.random() * (maxTop - margin);
        const nextRect = { x: left, y: top, w: noRectAbs.width, h: noRectAbs.height };

        if (rectsOverlap(nextRect, yesRect, 14)) {
          continue;
        }

        const distance = Math.hypot(left - noPosition.left, top - noPosition.top);
        if (distance < 72) {
          continue;
        }

        found = { left, top };
        break;
      }

      if (!found) {
        found = { left: maxLeft, top: maxTop };
      }

      setNoPosition(found.left, found.top);
      noDodgeCount += 1;
      bumpYesButton();

      if (fromTap) {
        showHint("Nice try üòÑ");
      }

      if (noDodgeCount >= 6) {
        oneAnswerCaption.hidden = false;
      }
    }

    function createHeartBurst(x, y, count, spread) {
      if (reduceMotion) {
        return;
      }

      for (let i = 0; i < count; i += 1) {
        const heart = document.createElement("span");
        heart.className = "particle-heart";
        heart.textContent = "‚ù§";
        const angle = Math.random() * Math.PI * 2;
        const distance = 18 + Math.random() * spread;
        const dx = Math.cos(angle) * distance;
        const dy = -18 - Math.abs(Math.sin(angle) * distance * 1.1);
        heart.style.left = x + "px";
        heart.style.top = y + "px";
        heart.style.setProperty("--dx", dx.toFixed(1) + "px");
        heart.style.setProperty("--dy", dy.toFixed(1) + "px");
        heart.style.setProperty("--dur", (640 + Math.random() * 430).toFixed(0) + "ms");
        heart.style.setProperty("--size", (11 + Math.random() * 10).toFixed(0) + "px");
        particleLayer.appendChild(heart);

        setTimeout(() => {
          heart.remove();
        }, 1300);
      }
    }

    function burstFromElement(el, count, spread) {
      const rect = el.getBoundingClientRect();
      const x = rect.left + rect.width / 2;
      const y = rect.top + rect.height / 2;
      createHeartBurst(x, y, count, spread);
    }

    function updateProgress() {
      progressText.textContent = "Opened " + openedCount + " / 12 hearts";
    }

    function updateEnvelopeProgress() {
      const opened = envelopesOpened.filter(Boolean).length;
      envelopeProgress.textContent = "Opened " + opened + " / 6";
    }

    function renderEnvelopes() {
      envelopeGrid.innerHTML = "";

      envelopes.forEach((item, index) => {
        const card = document.createElement("article");
        card.className = "envelope-card";
        card.setAttribute("role", "listitem");
        if (envelopesOpened[index]) {
          card.classList.add("opened");
        }

        const btn = document.createElement("button");
        btn.className = "envelope-btn";
        btn.type = "button";
        btn.setAttribute("aria-label", item.title);
        btn.setAttribute("aria-expanded", envelopesOpened[index] ? "true" : "false");
        btn.textContent = item.title;
        btn.addEventListener("click", (event) => {
          envelopesOpened[index] = !envelopesOpened[index];
          renderEnvelopes();
          updateEnvelopeProgress();
          if (envelopesOpened[index]) {
            createHeartBurst(event.clientX, event.clientY, 5, 40);
          }
        });

        const message = document.createElement("p");
        message.className = "envelope-message";
        message.textContent = item.message;

        card.appendChild(btn);
        card.appendChild(message);
        envelopeGrid.appendChild(card);
      });
    }

    function renderQuizStep() {
      if (quizAdvanceTimer) {
        clearTimeout(quizAdvanceTimer);
        quizAdvanceTimer = null;
      }
      quizOptions.innerHTML = "";
      quizFeedback.textContent = "";
      quizLocked = false;

      if (quizStep >= quizQuestions.length) {
        quizStepText.textContent = "Completed";
        quizQuestionText.textContent = "That was cute.";
        quizResult.hidden = false;
        quizScoreText.textContent = "Score: " + quizScore + " / " + quizQuestions.length;
        return;
      }

      quizResult.hidden = true;
      const current = quizQuestions[quizStep];
      quizStepText.textContent = "Question " + (quizStep + 1) + " / " + quizQuestions.length;
      quizQuestionText.textContent = current.question;

      current.options.forEach((option, index) => {
        const btn = document.createElement("button");
        btn.className = "quiz-option";
        btn.type = "button";
        btn.setAttribute("aria-label", "Option " + quizLetters[index] + ": " + option);
        btn.textContent = quizLetters[index] + ") " + option;
        btn.addEventListener("click", () => {
          if (quizLocked) {
            return;
          }
          quizLocked = true;
          const correct = index === current.correct;
          if (correct) {
            quizScore += 1;
            quizFeedback.textContent = "Correct üòÑ";
          } else {
            quizFeedback.textContent = "Nice try üòÑ Correct answer: " + quizLetters[current.correct];
          }

          quizAdvanceTimer = setTimeout(() => {
            quizStep += 1;
            renderQuizStep();
          }, reduceMotion ? 40 : 760);
        });
        quizOptions.appendChild(btn);
      });
    }

    function revealAfterHearts() {
      if (afterHeartsVisible) {
        return;
      }
      afterHeartsVisible = true;
      afterHeartsSection.classList.add("visible");
      if (reduceMotion) {
        afterHeartsSection.scrollIntoView({ block: "start" });
      } else {
        afterHeartsSection.scrollIntoView({ behavior: "smooth", block: "start" });
      }
    }

    function resetSecretModule() {
      secretUnlocked = false;
      secretCodeInput.value = "";
      secretFeedback.textContent = "";
      secretMessageCard.hidden = true;
      secretMessageCard.classList.remove("show");
    }

    function tryUnlockSecret() {
      const guess = secretCodeInput.value.trim();
      if (guess.toUpperCase() === secretCode) {
        secretUnlocked = true;
        secretFeedback.textContent = "Unlocked üíñ";
        secretMessageCard.hidden = false;
        requestAnimationFrame(() => {
          secretMessageCard.classList.add("show");
        });
        const rect = secretMessageCard.getBoundingClientRect();
        createHeartBurst(rect.left + rect.width / 2, rect.top + 20, 14, 75);
      } else {
        secretFeedback.textContent = "Almost üòÑ Try again.";
      }
    }

    function updateBackToTopVisibility() {
      if (window.scrollY > 420) {
        backToTopBtn.classList.add("show");
      } else {
        backToTopBtn.classList.remove("show");
      }
    }

    function maybeShowFinale() {
      if (openedCount !== reasons.length || !finaleCard.hidden) {
        return;
      }

      finaleCard.hidden = false;
      oneMoreBtn.hidden = false;
      requestAnimationFrame(() => {
        finaleCard.classList.add("show");
      });

      const centerX = window.innerWidth / 2;
      const centerY = Math.min(window.innerHeight * 0.44, 360);
      createHeartBurst(centerX, centerY, 28, 130);
    }

    function openReason(index, clickEvent) {
      if (openedHearts[index]) {
        return;
      }

      openedHearts[index] = true;
      openedCount += 1;
      updateProgress();

      const card = heartsGrid.querySelector('[data-index="' + index + '"]');
      if (card) {
        card.classList.add("opened");
        const trigger = card.querySelector("button");
        if (trigger) {
          trigger.setAttribute("aria-pressed", "true");
        }
      }

      if (clickEvent && typeof clickEvent.clientX === "number") {
        createHeartBurst(clickEvent.clientX, clickEvent.clientY, 8, 50);
      } else if (card) {
        burstFromElement(card, 8, 52);
      }

      maybeShowFinale();
    }

    function renderHearts() {
      heartsGrid.innerHTML = "";

      order.forEach((index) => {
        const card = document.createElement("article");
        card.className = "reason-card";
        card.dataset.index = String(index);
        if (openedHearts[index]) {
          card.classList.add("opened");
        }
        card.setAttribute("role", "listitem");

        const btn = document.createElement("button");
        btn.className = "heart-btn";
        btn.type = "button";
        btn.setAttribute("aria-label", "Open reason " + (index + 1));
        btn.setAttribute("aria-pressed", openedHearts[index] ? "true" : "false");

        const shape = document.createElement("span");
        shape.className = "heart-shape";
        shape.setAttribute("aria-hidden", "true");

        const num = document.createElement("span");
        num.className = "heart-index";
        num.textContent = String(index + 1);
        num.setAttribute("aria-hidden", "true");

        const reasonText = document.createElement("p");
        reasonText.className = "reason-text";
        reasonText.textContent = reasons[index];

        btn.addEventListener("click", (event) => {
          openReason(index, event);
        });

        btn.appendChild(shape);
        btn.appendChild(num);
        card.appendChild(btn);
        card.appendChild(reasonText);
        heartsGrid.appendChild(card);
      });
    }

    function revealPressStep() {
      hasAccepted = true;
      warmLine.classList.add("show");
      choiceArea.classList.add("hidden");

      setTimeout(() => {
        pressWrap.hidden = false;
        requestAnimationFrame(() => {
          pressWrap.classList.add("show");
        });
      }, reduceMotion ? 10 : 180);
    }

    function revealReasons() {
      if (reasonsVisible) {
        return;
      }

      reasonsVisible = true;
      landingCard.classList.add("exiting");

      setTimeout(() => {
        landingSection.hidden = true;
        reasonsSection.classList.add("visible");
        if (!reduceMotion) {
          reasonsSection.scrollIntoView({ behavior: "smooth", block: "start" });
        }
      }, reduceMotion ? 20 : 320);
    }

    function shuffleHearts() {
      for (let i = order.length - 1; i > 0; i -= 1) {
        const j = Math.floor(Math.random() * (i + 1));
        [order[i], order[j]] = [order[j], order[i]];
      }
      renderHearts();
    }

    function resetAll() {
      openedHearts = new Array(12).fill(false);
      openedCount = 0;
      noDodgeCount = 0;
      envelopesOpened = new Array(6).fill(false);
      quizStep = 0;
      quizScore = 0;
      secretUnlocked = false;
      quizLocked = false;
      if (quizAdvanceTimer) {
        clearTimeout(quizAdvanceTimer);
        quizAdvanceTimer = null;
      }
      yesScale = 1;
      hasAccepted = false;
      reasonsVisible = false;
      afterHeartsVisible = false;
      order = Array.from({ length: reasons.length }, (_, i) => i);
      questionLine.textContent = "Will you be my Valentine?";
      warmLine.classList.remove("show");
      choiceArea.classList.remove("hidden");
      pressWrap.hidden = true;
      pressWrap.classList.remove("show");
      oneAnswerCaption.hidden = true;
      dodgeHint.textContent = "";
      yesBtn.style.transform = "scale(1)";
      landingSection.hidden = false;
      landingCard.classList.remove("exiting");
      reasonsSection.classList.remove("visible");
      afterHeartsSection.classList.remove("visible");
      finaleCard.hidden = true;
      finaleCard.classList.remove("show");
      oneMoreBtn.hidden = true;
      oneMoreBtn.blur();
      updateEnvelopeProgress();
      renderEnvelopes();
      renderQuizStep();
      resetSecretModule();
      updateProgress();
      renderHearts();
      setTimeout(() => {
        setInitialButtonLayout();
      }, 20);

      window.scrollTo({ top: 0, behavior: reduceMotion ? "auto" : "smooth" });
    }

    yesBtn.addEventListener("click", () => {
      if (hasAccepted) {
        return;
      }
      burstFromElement(yesBtn, 14, 88);
      revealPressStep();
    });

    noBtn.addEventListener("mouseenter", () => {
      if (!isTouchDevice) {
        dodgeNoButton(false);
      }
    });

    choiceArea.addEventListener("mousemove", (event) => {
      if (isTouchDevice || hasAccepted) {
        return;
      }
      const rect = noBtn.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      const distance = Math.hypot(event.clientX - centerX, event.clientY - centerY);
      if (distance < 140) {
        dodgeNoButton(false);
      }
    });

    noBtn.addEventListener("click", (event) => {
      event.preventDefault();
      dodgeNoButton(isTouchDevice);
    });

    noBtn.addEventListener("pointerdown", (event) => {
      if (event.pointerType !== "mouse") {
        event.preventDefault();
        dodgeNoButton(true);
      }
    });

    pressBtn.addEventListener("click", (event) => {
      const oldLabel = pressBtn.textContent;
      const x = typeof event.clientX === "number" ? event.clientX : pressBtn.getBoundingClientRect().left;
      const y = typeof event.clientY === "number" ? event.clientY : pressBtn.getBoundingClientRect().top;
      createHeartBurst(x, y, 12, 94);
      pressBtn.textContent = "Okay okay‚Ä¶ üòÑ";
      setTimeout(() => {
        pressBtn.textContent = oldLabel;
      }, 1000);
      revealReasons();
    });

    oneMoreBtn.addEventListener("click", (event) => {
      if (typeof event.clientX === "number") {
        createHeartBurst(event.clientX, event.clientY, 10, 64);
      } else {
        burstFromElement(oneMoreBtn, 10, 64);
      }
      revealAfterHearts();
    });

    closeEnvelopesBtn.addEventListener("click", () => {
      envelopesOpened = new Array(6).fill(false);
      renderEnvelopes();
      updateEnvelopeProgress();
    });

    secretUnlockBtn.addEventListener("click", () => {
      tryUnlockSecret();
    });

    secretCodeInput.addEventListener("keydown", (event) => {
      if (event.key === "Enter") {
        event.preventDefault();
        tryUnlockSecret();
      }
    });

    shuffleBtn.addEventListener("click", () => {
      shuffleHearts();
    });

    resetBtn.addEventListener("click", () => {
      resetAll();
    });

    window.addEventListener("resize", () => {
      if (!hasAccepted) {
        setInitialButtonLayout();
      }
    });

    window.addEventListener("scroll", () => {
      updateBackToTopVisibility();
    });

    backToTopBtn.addEventListener("click", () => {
      window.scrollTo({ top: 0, behavior: reduceMotion ? "auto" : "smooth" });
    });

    updateProgress();
    renderHearts();
    updateEnvelopeProgress();
    renderEnvelopes();
    renderQuizStep();
    resetSecretModule();
    updateBackToTopVisibility();
    setInitialButtonLayout();
  </script>
</body>
</html>
